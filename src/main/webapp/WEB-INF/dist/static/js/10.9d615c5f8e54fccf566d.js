webpackJsonp([10],{NBS0:function(e,t){},PDv8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("mvHQ"),s=n.n(a),i=n("Xxa5"),r=n.n(i),o=n("exGp"),u=n.n(o),c=n("Dd8w"),l=n.n(c),d=n("NYxO"),p=["单选题","多选题","矩阵题","简答题"],v={name:"question",data:function(){return{contentH:0,gobackTimer:null,types:p,rate:5,loading:!0,nodata:!1,data:{}}},computed:l()({},Object(d.c)(["info"]),{wrapHeight:function(){return this.contentH}}),mounted:function(){var e=this;this.$nextTick(function(){e.contentH=document.documentElement.clientHeight}),this.getData()},methods:{getData:function(){var e=this;return u()(r.a.mark(function t(){var n,a,s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={studentId:e.info.id,estimateId:e.$route.query.queid},t.next=3,e.$Request.get("/estimate/getQuestionnaireByWeChat.do",n);case 3:if(a=t.sent,e.loading=!1,a&&0===a.code){s=a.list;try{s=s&&s.content?JSON.parse(s.content):[]}catch(e){s=[]}s=e.formatData(s),e.nodata=!s.length,e.data=s}else e.nodata=!0;case 6:case"end":return t.stop()}},t,e)}))()},formatData:function(e){var t=JSON.parse(s()(e));return t.forEach(function(e){e.subjectType=parseInt(e.subjectType),e.requiredFields=parseInt(e.requiredFields);var t=e.subjectType;if(e.options=[],0===t&&(e.answer=null,e.op.forEach(function(t,n){e.options.push({index:n+1,value:t,score:e.score[n],isexpand:1*e.mustAnswer[n],expandval:""})})),1===t&&(e.answer=[],e.op.forEach(function(t,n){e.options.push({index:n+1,value:t,score:e.score[n],isexpand:1*e.mustAnswer[n],expandval:""})})),2===t){e.opt.length;e.answer=[],e.opt.forEach(function(t,n){var a=[];e.answer.push(""),e.op.forEach(function(t,n){a.push({index:n+1,value:t,isexpand:1*e.mustAnswer[n],expandval:""})}),e.options.push({index:n+1,title:t,score:e.score[n],options:a})})}3===t&&(e.answer="")}),t},onRadioFocus:function(e,t){e.answer=t+1},onCheckboxFocus:function(e,t){-1===e.answer.indexOf(t+1)&&e.answer.push(t+1)},onSubmit:function(){var e=this,t=this.getParams(),n=this.verify(t);n?this.$toast(n):this.$dialog.confirm({title:"是否提交问卷？",className:"custom-confirm-dialog"}).then(function(){e.sureSubmit(t)}).catch(function(){})},getParams:function(){var e=JSON.parse(s()(this.data));return e.forEach(function(e,t){var n=[],a=e.subjectType;0===a&&(n=e.options.filter(function(t){return t.index===e.answer})),1===a&&(n=e.options.filter(function(t){return e.answer.indexOf(t.index)>-1})),2===a&&e.options.forEach(function(t,a){t.options.forEach(function(s,i){e.answer[a]&&e.answer[a]===s.index&&n.push({optindex:t.index,index:s.index,value:e.answer[a],score:e.score[a],isexpand:s.isexpand,expandval:s.expandval})})}),3===a&&e.answer.length&&(n=[{value:e.answer,score:e.score||"",expandval:e.answer}]);var s=[];n.forEach(function(e,t){var n={c_opt:e.optindex||"",c_op:e.index||"",c_detail:e.expandval||""};s.push(n)}),e.active=e.answer,e.answer=s}),e},verify:function(e){var t=-1,n=null,a=function(a){var s=e[a];if(s.requiredFields){if(0===s.subjectType){if(!s.answer.length)return t=a,n="请先完成问卷！","break";if(s.options.filter(function(e){return e.isexpand&&!e.expandval&&s.active===e.index}).length)return t=a,n="请先完成问卷！","break"}else if(1===s.subjectType){if(!s.answer.length)return t=a,n="请先完成问卷！","break";if(s.options.filter(function(e){return e.isexpand&&!e.expandval&&s.active.indexOf(e.index)>-1}).length)return t=a,n="请先完成问卷！","break"}else if(2===s.subjectType){if(!s.answer.length)return t=a,n="请先完成问卷！","break";var r=s.options;for(i=0;i<r.length;i++){var o=r[i].options.filter(function(e){return e.isexpand&&!e.expandval&&s.active[i]===e.index});if(!s.active[i]||o.length)return t=a,n="请先完成问卷！","break|aaa"}}else if(3===s.subjectType&&!s.active)return t=a,n="请先完成问卷！","break"}else if(0===s.subjectType){if(s.options.filter(function(e){return e.isexpand&&!e.expandval&&s.active===e.index}).length)return t=a,n="请先完成问卷！","break"}else if(1===s.subjectType){if(s.options.filter(function(e){return e.isexpand&&!e.expandval&&s.active.indexOf(e.index)>-1}).length)return t=a,n="请先完成问卷！","break"}else if(2===s.subjectType){var u=s.options;for(i=0;i<u.length;i++){if(u[i].options.filter(function(e){return e.isexpand&&!e.expandval&&s.active[i]===e.index}).length)return t=a,n="请先完成问卷！","break|aaa"}}};e:for(var s=0;s<e.length;s++){var i;switch(a(s)){case"break":case"break|aaa":break e}}if(-1!==t){var r=document.getElementById("question"+t).offsetTop;window.scrollTo(0,r)}return n},sureSubmit:function(e){var t=this;return u()(r.a.mark(function n(){var a,i;return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a={studentId:t.info.id,estimateId:t.$route.query.queid,jsonData:s()(e)},n.next=3,t.$Request.post("/estimate/saveQiByWeChat.do",a);case 3:(i=n.sent)&&0===i.code&&(t.gobackTimer=setTimeout(function(){history.length>2?history.back():t.$router.replace({path:"/questionlist",query:{id:t.$route.query.id}})},1500),t.$toast.success("提交成功！"));case 5:case"end":return n.stop()}},n,t)}))()}},beforeDestroy:function(){clearTimeout(this.gobackTimer)}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wenjuan-main",style:{minHeight:e.wrapHeight+"px"}},[e.nodata?n("div",{staticClass:"no-data"}):[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"wenjuan-title"},[e._v("希望您本次培训给出建议和意见！")]),e._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"wenjuan-list"},[e._l(e.data,function(t,a){return[n("li",{key:a,attrs:{id:"question"+a}},[n("div",{staticClass:"question-type"},[e._v(e._s(e.types[t.subjectType]))]),e._v(" "),n("div",{staticClass:"question-content"},[n("div",{staticClass:"question-title",class:t.requiredFields?"require":""},[e._v(e._s(a+1)+". "+e._s(t.title))]),e._v(" "),0===t.subjectType?n("van-radio-group",{staticClass:"question-options",model:{value:t.answer,callback:function(n){e.$set(t,"answer",n)},expression:"item.answer"}},[e._l(t.options,function(a,s){return[n("van-radio",{attrs:{name:s+1}},[e._v(e._s(a.value))]),e._v(" "),a.isexpand?n("div",{staticClass:"custom-input",class:a.isexpand&&t.answer===s+1?"isrequire":""},[n("input",{directives:[{name:"model",rawName:"v-model",value:a.expandval,expression:"option.expandval"}],attrs:{type:"text",placeholder:a.isexpand&&t.answer===s+1?"必填":""},domProps:{value:a.expandval},on:{focus:function(n){return e.onRadioFocus(t,s)},input:function(t){t.target.composing||e.$set(a,"expandval",t.target.value)}}})]):e._e()]})],2):e._e(),e._v(" "),1===t.subjectType?n("van-checkbox-group",{staticClass:"question-options",model:{value:t.answer,callback:function(n){e.$set(t,"answer",n)},expression:"item.answer"}},[e._l(t.options,function(a,s){return[n("van-checkbox",{attrs:{shape:"square",name:s+1}},[e._v(e._s(a.value))]),e._v(" "),a.isexpand?n("div",{staticClass:"custom-input",class:a.isexpand&&t.answer.indexOf(s+1)>-1?"isrequire":""},[n("input",{directives:[{name:"model",rawName:"v-model",value:a.expandval,expression:"option.expandval"}],attrs:{type:"text",placeholder:a.isexpand&&t.answer.indexOf(s+1)>-1?"必填":""},domProps:{value:a.expandval},on:{focus:function(n){return e.onCheckboxFocus(t,s)},input:function(t){t.target.composing||e.$set(a,"expandval",t.target.value)}}})]):e._e()]})],2):e._e(),e._v(" "),2===t.subjectType?n("div",{staticClass:"array-options"},[e._l(t.options,function(a,s){return[n("div",{staticClass:"arry-item"},[e._v(e._s(a.title))]),e._v(" "),n("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.answer[s],callback:function(n){e.$set(t.answer,s,n)},expression:"item.answer[i]"}},[e._l(a.options,function(t,a){return[n("van-radio",{attrs:{name:a+1}},[e._v(e._s(t.value))])]})],2),e._v(" "),e._l(a.options,function(a,i){return[n("div",{directives:[{name:"show",rawName:"v-show",value:a.isexpand&&t.answer[s]===i+1,expression:"opt.isexpand&&item.answer[i]===j+1"}],staticClass:"custom-input",class:a.isexpand&&t.answer[s]===i+1?"isrequire":""},[n("input",{directives:[{name:"model",rawName:"v-model",value:a.expandval,expression:"opt.expandval"}],attrs:{type:"text",placeholder:a.isexpand&&t.answer[s]===i+1?"必填":""},domProps:{value:a.expandval},on:{input:function(t){t.target.composing||e.$set(a,"expandval",t.target.value)}}})])]})]})],2):e._e(),e._v(" "),3===t.subjectType?n("div",{staticClass:"text-area"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.answer,expression:"item.answer"}],attrs:{rows:"4",maxlength:t.wordRestriction},domProps:{value:t.answer},on:{input:function(n){n.target.composing||e.$set(t,"answer",n.target.value)}}}),e._v(" "),n("p",{staticClass:"num-limit"},[e._v(e._s(t.answer.length)+"/"+e._s(t.wordRestriction))])]):e._e()],1)])]})],2)],e._v(" "),n("div",{staticClass:"wenjuan-footer"},[n("van-button",{attrs:{round:"",block:"",type:"primary"},on:{click:e.onSubmit}},[e._v("提交")])],1)],2)},staticRenderFns:[]};var x=n("VU/8")(v,f,!1,function(e){n("NBS0")},null,null);t.default=x.exports}});
//# sourceMappingURL=10.9d615c5f8e54fccf566d.js.map