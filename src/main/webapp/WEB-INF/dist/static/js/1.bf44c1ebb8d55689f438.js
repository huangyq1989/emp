webpackJsonp([1],{"5RxF":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("mvHQ"),a=n.n(s),i=n("Gu7T"),r=n.n(i),o=n("Xxa5"),u=n.n(o),c=n("exGp"),l=n.n(c),d=n("Dd8w"),f=n.n(d),h=n("NYxO"),v={name:"answer",props:{data:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1},current:{type:Number}},computed:{totalScore:function(){var t=0;return this.data.forEach(function(e){t+=1*e.score}),t}},data:function(){return{}},mounted:function(){console.log(this.data)},methods:{onClick:function(t){this.disabled||this.$emit("change",t)}}},m={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"answer-main"},[n("div",{staticClass:"answer-main-title"},[t._v("答题卡")]),t._v(" "),n("div",{staticClass:"answer-main-subtitle"},[t._v("本卷总共"+t._s(t.data.length)+"道题，总分"+t._s(t.totalScore)+"分")]),t._v(" "),t._m(0),t._v(" "),n("div",[n("div"),t._v(" "),n("div",{staticClass:"answer-list"},[t._l(t.data,function(e,s){return[t._v("\n\t\t\t\t"+t._s(e.answer)+"\n\t\t\t\t"),1*e.subjectType==1?n("a",{class:{answered:e.answer.length,current:t.current===s},on:{click:function(e){return t.onClick(s)}}},[t._v(t._s(s+1))]):n("a",{class:{answered:e.answer,current:t.current===s},on:{click:function(e){return t.onClick(s)}}},[t._v(t._s(s+1))])]})],2)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"answer-legend"},[e("span",{staticClass:"active"},[e("a"),e("span",[this._v("已答")])]),this._v(" "),e("span",[e("a"),e("span",[this._v("未答")])])])}]};var p=n("VU/8")(v,m,!1,function(t){n("uN90")},null,null).exports,x=["单选题","多选题","判断题"],g={name:"exam",data:function(){return{contentH:0,gobackTimer:null,loading:!0,nodata:!1,types:x,limit:null,count:null,timer:"00:00:00",status:null,interval:null,intervalTask:null,activeIndex:0,total:0,result:{},questions:[]}},watch:{questions:{handler:function(t,e){this.questions.length&&1===this.status&&this.cacheData()},deep:!0}},computed:f()({},Object(h.c)(["info"]),{wrapHeight:function(){return this.contentH},currentIndex:function(){return 0===this.total?this.activeIndex:this.activeIndex+1}}),components:{Answer:p},mounted:function(){var t=this;this.$nextTick(function(){t.contentH=document.documentElement.clientHeight}),this.getData()},methods:{cacheData:function(){var t=this.info.id+"_"+this.$route.query.id+"_"+this.$route.query.examid;this.$Utils.setItem(t,this.questions,10/24/60)},getCacheData:function(){var t=this.info.id+"_"+this.$route.query.id+"_"+this.$route.query.examid;return this.$Utils.getItem(t)},pollingTask:function(){var t=this;this.intervalTask=setInterval(function(){t.getExamStatus()},3e3)},getExamStatus:function(){var t=this;return l()(u.a.mark(function e(){var n,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={studentId:t.info.id,examinationId:t.$route.query.examid},e.next=3,t.$Request.get("/examination/queryEcCodeByWeChat.do",n);case 3:(s=e.sent)&&0===s.code?2===s.examinationCode&&t.sureSubmit(2):t.$notify.clear();case 5:case"end":return e.stop()}},e,t)}))()},formatDate:function(t){return t=this.$Utils.toDate(t),this.$Utils.dateFtt("yyyy-MM-dd hh:mm:ss",t)},getExamTime:function(t,e){var n=this.$Utils.toDate(t).getTime()-this.$Utils.toDate(e).getTime();this.status=n>0?1:0,this.count=parseInt(n/1e3),this.count>0&&(this.timer=this.getFmtTime(this.count),this.initTimer(),this.pollingTask())},getData:function(){var t=this;return l()(u.a.mark(function e(){var n,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={studentId:t.info.id,examinationId:t.$route.query.examid},e.next=3,t.$Request.get("/examination/getTestPaperByWeChat.do",n);case 3:s=e.sent,t.loading=!1,s&&0===s.code?t.formatQuestion(s):t.nodata=!0;case 6:case"end":return e.stop()}},e,t)}))()},formatQuestion:function(t){var e=t.list||{},n=this.getCacheData();if(n&&n.length&&!this.$route.query.isreexam)n=n;else{var s=e.content?JSON.parse(e.content):[];if(s.forEach(function(t){t.answer=1*t.subjectType==1?[]:null}),e.isDisorder){var a=s.filter(function(t){return 1*t.subjectType==0});a=this.shuffle(a);var i=s.filter(function(t){return 1*t.subjectType==1});i=this.shuffle(i);var o=s.filter(function(t){return 1*t.subjectType==2});o=this.shuffle(o),n=[].concat(r()(a),r()(i),r()(o))}else n=s}this.updateExamStatus(e,n)},updateExamStatus:function(t,e){var n=this;return l()(u.a.mark(function s(){var a,i;return u.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a={studentId:n.info.id,examinationId:n.$route.query.examid},s.next=3,n.$Request.get("/examination/updateECbyExamination.do",a);case 3:(i=s.sent)&&0===i.code&&(console.log(i.list,e),n.result=t,n.questions=e,n.total=e.length,n.nodata=!e.length,n.getExamTime(i.list,i.nowTime));case 5:case"end":return s.stop()}},s,n)}))()},initTimer:function(){var t=this;this.interval=setInterval(function(){0===t.count?(t.clearInterval(),t.sureSubmit(1)):(t.count--,t.timer=t.getFmtTime(t.count))},1e3)},getFmtTime:function(t){var e=parseInt(t/3600%60),n=parseInt(t/60%60),s=parseInt(t%60);return(e=e<10?"0"+e:e)+":"+(n=n<10?"0"+n:n)+":"+(s=s<10?"0"+s:s)},clearInterval:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){clearInterval(this.interval),this.interval=null}),clearPollingTask:function(){clearInterval(this.intervalTask),this.intervalTask=null},shuffle:function(t){for(var e=t.concat(),n=e.length,s=0;s<n;s++){var a=Math.floor(Math.random()*n),i=e[a];e[a]=e[s],e[s]=i}return e},onPrev:function(){this.activeIndex--;var t=document.getElementById("q"+this.activeIndex).offsetTop,e=this.$refs.header.offsetHeight;window.scrollTo(0,t-e)},onNext:function(){this.activeIndex++;var t=document.getElementById("q"+this.activeIndex).offsetTop,e=this.$refs.header.offsetHeight;window.scrollTo(0,t-e)},showAnswerSheet:function(){var t=document.getElementById("sheet").offsetTop,e=this.$refs.header.offsetHeight;window.scrollTo(0,t-e)},onChange:function(t){this.activeIndex=t;var e=document.getElementById("q"+this.activeIndex).offsetTop,n=this.$refs.header.offsetHeight;window.scrollTo(0,e-n)},onClick:function(){var t=this;this.$dialog.confirm({title:"是否确定交卷？",className:"custom-confirm-dialog"}).then(function(){t.sureSubmit()}).catch(function(){})},sureSubmit:function(t){var e=this;return l()(u.a.mark(function n(){var s,i,r;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(s=JSON.parse(a()(e.questions))).forEach(function(t){1*t.subjectType!=1&&(t.answer=[t.answer])}),i={studentId:e.info.id,examinationId:e.$route.query.examid,jsonData:a()(s)},n.next=5,e.$Request.post("/examination/saveTpByWeChat.do",i);case 5:r=n.sent,e.clearPollingTask(),r&&0===r.code&&(t?2===t?e.$toast.success("老师回收试卷，您的试卷已自动提交！"):e.$toast.success("考试时限已到，您的试卷已自动提交！"):e.$toast.success("提交成功！"),e.gobackTimer=setTimeout(function(){history.length>2?history.back():e.$router.replace({path:"/examlist",query:{id:e.$route.query.id}})},1500));case 8:case"end":return n.stop()}},n,e)}))()}},beforeDestroy:function(){clearTimeout(this.gobackTimer),this.clearInterval(),this.clearPollingTask()}},y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"exam-main",style:{minHeight:t.wrapHeight+"px"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],ref:"header",staticClass:"eaxm-header"},[n("div",{staticClass:"count-down"},[t._v("倒计时："),n("span",[t._v(t._s(t.timer))])]),t._v(" "),n("div",{staticClass:"btn-block"},[n("van-button",{attrs:{plain:"",type:"primary",size:"small",disabled:1!==t.status},on:{click:t.onClick}},[t._v("交卷")])],1)]),t._v(" "),n("div",{staticClass:"exam-content"},[t.nodata?n("div",{staticClass:"no-data"}):[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],staticClass:"eaxm-content-main"},[n("ul",[t._l(t.questions,function(e,s){return[n("li",{key:s,attrs:{id:"q"+s}},[n("div",{staticClass:"question-type"},[t._v(t._s(t.types[1*e.subjectType]))]),t._v(" "),n("div",{staticClass:"question-content"},[n("div",{staticClass:"question-title"},[t._v(t._s(s+1)+". "+t._s(e.title))]),t._v(" "),1*e.subjectType==0||1*e.subjectType==2?n("van-radio-group",{staticClass:"question-options",model:{value:e.answer,callback:function(n){t.$set(e,"answer",n)},expression:"item.answer"}},[t._l(e.op,function(e,s){return[n("van-radio",{attrs:{name:s+1,disabled:1!==t.status}},[t._v(t._s(e))])]})],2):t._e(),t._v(" "),1*e.subjectType==1?n("van-checkbox-group",{staticClass:"question-options",model:{value:e.answer,callback:function(n){t.$set(e,"answer",n)},expression:"item.answer"}},[t._l(e.op,function(e,s){return[n("van-checkbox",{attrs:{shape:"square",name:s+1,disabled:1!==t.status}},[t._v(t._s(e))])]})],2):t._e()],1)])]})],2),t._v(" "),n("Answer",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],attrs:{id:"sheet",disabled:1!==t.status,current:t.activeIndex,data:t.questions},on:{change:t.onChange}})],1)]],2),t._v(" "),n("div",{staticClass:"exam-footer"},[n("div",{staticClass:"answer-sheet-btn"},[n("van-button",{attrs:{type:"primary",block:"",disabled:!t.total||1!==t.status},on:{click:t.showAnswerSheet}},[t._v(t._s(t.currentIndex)+"/"+t._s(t.total))])],1),t._v(" "),n("div",{staticClass:"btns-group"},[n("van-button",{attrs:{type:"primary",block:"",disabled:!t.activeIndex||1!==t.status},on:{click:t.onPrev}},[t._v("上一题")]),t._v(" "),n("van-button",{attrs:{type:"primary",block:"",disabled:t.activeIndex+1===t.total||!t.total||1!==t.status},on:{click:t.onNext}},[t._v("下一题")])],1)])])},staticRenderFns:[]};var _=n("VU/8")(g,y,!1,function(t){n("hoYA")},null,null);e.default=_.exports},"5zde":function(t,e,n){n("zQR9"),n("qyJz"),t.exports=n("FeBl").Array.from},Gu7T:function(t,e,n){"use strict";e.__esModule=!0;var s,a=n("c/Tr"),i=(s=a)&&s.__esModule?s:{default:s};e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,i.default)(t)}},"c/Tr":function(t,e,n){t.exports={default:n("5zde"),__esModule:!0}},fBQ2:function(t,e,n){"use strict";var s=n("evD5"),a=n("X8DO");t.exports=function(t,e,n){e in t?s.f(t,e,a(0,n)):t[e]=n}},hoYA:function(t,e){},qyJz:function(t,e,n){"use strict";var s=n("+ZMJ"),a=n("kM2E"),i=n("sB3e"),r=n("msXi"),o=n("Mhyx"),u=n("QRG4"),c=n("fBQ2"),l=n("3fs2");a(a.S+a.F*!n("dY0y")(function(t){Array.from(t)}),"Array",{from:function(t){var e,n,a,d,f=i(t),h="function"==typeof this?this:Array,v=arguments.length,m=v>1?arguments[1]:void 0,p=void 0!==m,x=0,g=l(f);if(p&&(m=s(m,v>2?arguments[2]:void 0,2)),void 0==g||h==Array&&o(g))for(n=new h(e=u(f.length));e>x;x++)c(n,x,p?m(f[x],x):f[x]);else for(d=g.call(f),n=new h;!(a=d.next()).done;x++)c(n,x,p?r(d,m,[a.value,x],!0):a.value);return n.length=x,n}})},uN90:function(t,e){}});
//# sourceMappingURL=1.bf44c1ebb8d55689f438.js.map